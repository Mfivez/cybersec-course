# **11.4 â€” Protection en temps rÃ©el (WAF, IDS, API Gateway)**

Les protections en temps rÃ©el sont des systÃ¨mes qui **surveillent, filtrent et bloquent** les requÃªtes malveillantes **avant** quâ€™elles nâ€™atteignent votre API ou pendant leur exÃ©cution.
Elles complÃ¨tent :

* la sÃ©curitÃ© applicative (dans votre code),
* la dÃ©tection via logs,
* la CI/CD sÃ©curisÃ©e.

Elles agissent comme une **couche dÃ©fensive supplÃ©mentaire**, indispensable pour toute API exposÃ©e Ã  Internet.

Dans ce chapitre, nous allons voir :

* ce quâ€™est un WAF
* ce quâ€™est un IDS/IPS
* le rÃ´le des API Gateways
* comment ces outils bloquent les attaques en temps rÃ©el
* leurs limites
* des schÃ©mas visuels pour bien comprendre

---

# **11.4.1 â€” Pourquoi une protection en temps rÃ©el est nÃ©cessaire ?**

MÃªme avec :

* une bonne validation dâ€™entrÃ©e,
* des tokens sÃ©curisÃ©s,
* un code propre,
* une CI/CD sans failles,
* une surveillance continueâ€¦

â€¦ il reste des risques :

* nouvelles attaques (0-day)
* scanners automatiques agressifs
* bots explorant vos endpoints
* attaques DDoS / bruteforce
* erreurs humaines dans le code
* failles dans les dÃ©pendances

Une couche de protection en temps rÃ©el **absorbe les attaques** avant quâ€™elles atteignent votre application.

---

# **11.4.2 â€” WAF (Web Application Firewall)**

Un **WAF** analyse le trafic HTTP pour bloquer :

* injections SQL
* XSS
* attaques sur fichiers
* patterns OWASP
* bots et scanners
* comportements anormaux
* attaques connues (signatures prÃ©-dÃ©finies)

Le WAF fonctionne en examinant **chaque requÃªte** et en la comparant :

1. Ã  des signatures dâ€™attaque connues,
2. Ã  des rÃ¨gles comportementales (heuristiques),
3. Ã  des modÃ¨les ML (plus avancÃ©).

### SchÃ©ma simple

```mermaid
flowchart LR
    A[RequÃªte HTTP] --> B[WAF]
    B -->|BloquÃ©e| C[X]
    B -->|AutorisÃ©| D[API Backend]
```

---

# **11.4.3 â€” Que peut bloquer un WAF ?**

### âœ” Tentatives dâ€™injection

```
' OR 1=1 --
<script>alert(1)</script>
../../../../etc/passwd
```

### âœ” Robots dâ€™attaque

* reconnaissance automatique
* scanners (Nikto, Gobusterâ€¦)
* scripts massifs

### âœ” DDoS applicatif (limitÃ©)

â†’ trop de requÃªtes simultanÃ©es

### âœ” Violations de rÃ¨gles CORS

â†’ peut bloquer des origines non autorisÃ©es

### âœ” Anomalies HTTP

â†’ requÃªtes malformÃ©es, header suspects

---

# **11.4.4 â€” IDS / IPS : surveillance et blocage**

### **IDS** (Intrusion Detection System)

â†’ DÃ©tecte les attaques
â†’ Nâ€™intervient pas directement
â†’ GÃ©nÃ¨re des alertes

### **IPS** (Intrusion Prevention System)

â†’ DÃ©tecte
â†’ **Bloque** automatiquement

Les deux peuvent Ãªtre couplÃ©s avec des logs API pour enrichir la dÃ©tection.

---

# **11.4.5 â€” SchÃ©ma IDS / IPS**

```mermaid
flowchart TD
    A[Trafic API] --> B[IDS]
    B --> C[DÃ©tection anomalie]
    C --> D[Alertes]
    
    A --> E[IPS]
    E --> F{Anormal ?}
    F -->|Oui| G[Blocage]
    F -->|Non| H[Continue vers API]
```

---

# **11.4.6 â€” API Gateway : le bouclier des microservices**

Une API Gateway agit comme :

* un point d'entrÃ©e unique
* un rÃ©partiteur
* un contrÃ´leur dâ€™accÃ¨s
* un analayseur de trafic
* un proxy intelligent

Elle peut implÃ©menter :

### âœ” Rate limiting (limitation de dÃ©bit)

### âœ” Quotas par utilisateur

### âœ” Authentification centralisÃ©e (JWT, OIDC)

### âœ” Signature des requÃªtes

### âœ” Validation schÃ©ma JSON

### âœ” Transformation de requÃªtes

### âœ” Protection DDoS

### âœ” Caching

### âœ” Audit et logging centralisÃ©

Exemples de Gateways :

* Kong
* Apigee
* AWS API Gateway
* NGINX / Traefik
* Ambassador / Istio (service mesh)

---

# **11.4.7 â€” Pourquoi une API Gateway amÃ©liore la sÃ©curitÃ© ?**

Parce quâ€™elle centralise :

* lâ€™accÃ¨s,
* lâ€™authentification,
* le contrÃ´le du dÃ©bit,
* la validation des requÃªtes,
* la dÃ©tection des anomalies.

Câ€™est une **couche obligatoire** pour les architectures modernes.

---

# **11.4.8 â€” SchÃ©ma global dâ€™une architecture protÃ©gÃ©e**

```mermaid
flowchart LR
    A[Client] --> B[WAF]
    B --> C[API Gateway]
    C --> D[API Backend]
    D --> E[Base de donnÃ©es]
```

Cette architecture superpose **plusieurs dÃ©fenses** :

* WAF (bloque les attaques connues)
* API Gateway (rÃ©gule et contrÃ´le lâ€™accÃ¨s)
* Backend (validation business + autorisation)

---

# **11.4.9 â€” Exemples dâ€™attaques bloquÃ©es en temps rÃ©el**

### ğŸ›‘ Injection SQL

â†’ WAF bloque car payload dangereux

### ğŸ›‘ Bruteforce

â†’ Gateway active rate limit â†’ renvoie 429

### ğŸ›‘ Exploration dâ€™API

â†’ WAF dÃ©tecte pattern suspect â†’ bannit IP

### ğŸ›‘ Token volÃ©

â†’ Gateway dÃ©tecte incohÃ©rence gÃ©ographique â†’ bloque

### ğŸ›‘ DDoS

â†’ API Gateway filtre + cloud provider absorbe le trafic

---

# **11.4.10 â€” Limites du WAF et de lâ€™API Gateway**

### âŒ WAF nâ€™est pas infaillible

Un attaquant peut contourner certaines rÃ¨gles.

### âŒ Ne comprend pas la logique mÃ©tier

Exemple :
â†’ Il ne sait pas si Alice peut voir la commande #42
â†’ Donc ne peut pas dÃ©tecter une BOLA

### âŒ Risque de faux positifs

Certaines requÃªtes lÃ©gitimes peuvent Ãªtre bloquÃ©es.

### âŒ NÃ©cessite une maintenance continue

* mise Ã  jour des rÃ¨gles
* tuning du rate limiting
* mise Ã  jour des signatures

---

# **11.4.11 â€” Les protections ML / comportementales modernes**

Des solutions avancÃ©es (Salt Security, Akamai API Security, Wallarm) appliquent :

* machine learning
* dÃ©tection comportementale
* analyse de sÃ©quence
* dÃ©tection dâ€™anomalies statistiques
* analyse profonde des flux JSON

â†’ Essential pour dÃ©tecter les attaques API complexes.

---

# **11.4.12 â€” RÃ©sumÃ© du sous-chapitre**

Protection en temps rÃ©el = **WAF + API Gateway + IDS/IPS**.

Leurs rÃ´les :

* bloquer les attaques connues
* limiter le dÃ©bit
* bloquer les bots
* identifier les comportements anormaux
* protÃ©ger les endpoints sensibles
* rÃ©duire la charge sur le backend

Mais ils **ne remplacent pas** :

* la validation dâ€™entrÃ©e
* lâ€™autorisation
* le Zero Trust
* les protections mÃ©tier contre BOLA

Ils ajoutent une couche essentielle :
**la dÃ©fense active en temps rÃ©el.**